define(["jquery","eventDispatcher","breakpoints","handlebars","ajaxConfig","fullscreenslide"],function(e,t,a,i,o,l){function r(){e(".the-edit-issue").removeClass("active"),e(".the-edit-articles").slideUp().removeClass("open")}function s(t){t&&t.preventDefault();var a=e(this).closest(".the-edit-issue"),i=0,o=e(".the-edit-articles.open");o.length>0&&o.offset().top<=a.offset().top&&(i=o.height());var l=!e(a).is(".active");r(),l&&(a.addClass("active"),e(a.attr("href")).addClass("open").css("opacity",0).slideDown("slow").animate({opacity:1},{duration:"slow"}),e("html, body").stop().animate({scrollTop:a.offset().top-(i+e("#header-main").height())},300),I())}function n(t){t&&t.preventDefault(),e(".the-edit-issue:hidden").not(".header-nav-item").slice(0,Math.min(O,e(".the-edit-issue:hidden").not(".header-nav-item").length)).each(function(){e(this).fadeIn("slow",function(){e(this).css("display","inline-block"),0===e(".the-edit-issue:hidden").not(".header-nav-item").length&&e(".the-edit-load-more").fadeOut("slow")})})}function c(){void 0!==e(this).data("url")&&(window.location.href=e(this).data("url"))}function d(t){t&&t.preventDefault();var a=(e(".social-trigger"),e(".social-overlay-icons"));a.hasClass("closed")?(a.removeClass("closed").fadeIn("slow"),e(this).removeClass("closed").addClass("open")):(a.addClass("closed").hide(),e(this).removeClass("open").addClass("closed"))}function h(t){t&&t.preventDefault(),e(".the-edit-article-copy-section:hidden").each(function(){e(this).slideDown("slow"),e(".the-edit-article-text-load-more").hide(),e(".the-edit-article-text-load-less").fadeIn("slow")})}function p(t){t&&t.preventDefault(),e(".the-edit-article-copy-section:gt(0)").each(function(){e(this).slideUp(500),e(".the-edit-article-text-load-more").fadeIn("slow"),e(".the-edit-article-text-load-less").hide();var t=e(this).parent(".the-edit-article-copy");e("html, body").stop().animate({scrollTop:t.offset().top-e("#header-main").height()},600)})}function v(){e("body").hasClass("_header-nav-is-open")&&e(".header-nav-parent-main").trigger("click");var t=e(window.location.hash.replace("#","#issue-")),a=0,i=e(".the-edit-articles.open");if(i.length>0&&i.offset().top<=t.offset().top&&(a=i.height(),I()),t.length>0){t.is(":hidden")&&n(),t.is(":hidden")&&n(),r(),t.addClass("active"),e(t.attr("href")).slideDown().addClass("open");var o=e(".the-edit-issue.active");e("html, body").stop().animate({scrollTop:o.offset().top-a-e("#header-main").height()},{duration:"slow"})}N()}function g(){e(this).hasClass("gucci-dim")||(window.location=e(this).data("prev"))}function y(t){e(this).hasClass("gucci-dim")?t.preventDefault():window.location=e(this).data("next")}function u(){var t=e(this).attr("href");e(t+" .carousel-inner").slick({dots:!1,draggabble:!1,infinite:!0,slidesToScroll:1,slidesToShow:3,centerMode:!0,centerPadding:"0px",responsive:[{breakpoint:1023,settings:{slidesToShow:1,swipeToSlide:!0}}]}),e(".article-overlay.runway-photo-gallery aside .photo-gallery-nav-option.first .gallery-number").html(e(".article-overlay .slick-active.slick-center img").data("number")),f(),m(),e(".article-overlay.runway-photo-gallery .overlay-close.overlay-close-button-first.close").on("click",function(){e(t+" .carousel-inner").slick("unslick")}),e('[id^="runway-photo-gallery-"]').css({height:"100%","padding-top":0})}function f(){var t=0;t="number"==typeof window.innerHeight?window.innerHeight:document.documentElement.clientHeight,e(".overlay.promo.overlay-photo-gallery .hero-background-image-large-wrapper").css("min-height",t),0===e("#page aside.social-overlay").length&&e(".photo-gallery-nav-option.last").hide()}function m(){function t(){e(".article-overlay:visible aside .photo-gallery-nav-option.first .gallery-number").html(e(".article-overlay .slick-active.slick-center img").data("number"))}e(".overlay.promo.overlay-photo-gallery.runway-photo-gallery").on("click, mouseout",".slick-slide, .slick-prev, .slick-next",function(){t()}),e(".overlay.promo.overlay-photo-gallery.runway-photo-gallery").on("touchend",".slick-slide, .slick-prev, .slick-next",function(){t()}),setTimeout(t,30)}function k(){var t=e(this),a=e(t).parent().find(".info-txt"),i=e(t).parent().find(".close-txt");e(a).hasClass("switch")?(e(a).hide().removeClass("switch"),e(i).fadeIn("slow").addClass("switch")):(e(i).hide().removeClass("switch"),e(a).fadeIn("slow").addClass("switch")),e(t).closest("aside").toggleClass("open"),e("aside").hasClass("open")?e(".photo-gallery-copy-section").slideDown("slow"):e(".photo-gallery-copy-section").slideUp("slow")}function w(){e("body").addClass("video-overlay-lock"),e(".video-actions-item.video-close").on("click",function(){e("body").removeClass("video-overlay-lock")})}function b(){e(".article-photo-gallery aside .photo-gallery-copy-section").html(e(".carousel-slide .gallery-image-content .photo-gallery-copy-section:first").html())}function C(t){if("social-overlay-content"!==t.target.className){e("#the-edit-share").find(".social-overlay-close").trigger("click"),e("body").unbind("click",C);var a=e(".overlay-photo-gallery.social-open").attr("id");e("#"+a+":visible")&&e("body").addClass("overlay-lock")}else"social-overlay-close"===t.target.className&&e("body").unbind("click",C)}function T(t){"social-overlay-content"!==t.target.className?(t.preventDefault(),t.stopPropagation(),e("#the-edit-share").removeClass("_active").hide(),e("body").addClass("overlay-lock"),e("body").unbind("click",T)):"social-overlay-close"===t.target.className&&e("body").unbind("click",T)}function x(){e(this).closest(".overlay-photo-gallery").hasClass("article-photo-gallery")&&(e(this).closest(".overlay-photo-gallery.article-photo-gallery").addClass("social-open").hide(),e(".overlay-photo-gallery").hasClass("social-open")&&e("body").bind("click",C)),e(".overlay-photo-gallery.runway-photo-gallery").hasClass("_active")&&e("body").bind("click",T)}function D(t){if(e("body").unbind("click",C),e("body").unbind("click",T),e(".overlay-photo-gallery.article-photo-gallery").hasClass("social-open")){var a=e(".overlay-photo-gallery.social-open").attr("id");e(".overlay-photo-gallery").removeClass("social-open"),e("#page").find('a[href="#'+a+'"]').trigger("click"),e("#"+a+":visible")&&e("body").addClass("overlay-lock")}else e(".overlay-photo-gallery.runway-photo-gallery").hasClass("_active")?(t.preventDefault(),t.stopPropagation(),e(".overlay.social-overlay").removeClass("_active").hide()):(e("#the-edit-share").removeClass("_active").hide(),e("body").removeClass("overlay-lock"),e("#page").removeAttr("style"))}function P(t){t.preventDefault(),t.stopPropagation();var a=e(this).attr("data-url");window.location=a}function A(t){t.preventDefault(),t.stopPropagation();var a=e(this).attr("data-url");window.location=a}function E(){if(a.is("standard")){if(e(".page-TheEditArchivePage").length)var t=".the-edit-articles .the-edit-artilces-list";else var t=".the-edit-articles.open .the-edit-artilces-list";var i=e(t+" .the-edit-article");e(t).reOrder(_(i))}}function I(){if(e(".page-TheEditArchivePage").length)var t=e(".the-edit-archive-load-more"),a=" .the-edit-artilces-list",l="articlecategory";else var t=e(".the-edit-articles.open .the-edit-articles-load-more"),a=" .the-edit-artilces-list",r=t.attr("data-issuetitle"),l="issueCode";var s=i.compile(e("#articlelist-item").html()),n=t.attr("data-articlecategory"),c=o.config,d=t.attr("data-url"),h=parseInt(t.attr("data-page")),p=c[d.toUpperCase()],v=l+"="+n+"&page="+h;e.ajax({url:p,dataType:"json",data:v}).done(function(i){h>=i.totalNumberOfPages&&t.addClass("hide");var o=h-1,l=H*o;if(e(".page-TheEditArchivePage").length)for(var c=0;c<i.articleCategory.articles.length;c++)i.articleCategory.articles[c].pos=c+l;else for(var c=0;c<i.articles.length;c++)i.articles[c].pos=c+l,i.articles[c].category=n,i.articles[c].categoryTitle=r;e("#"+n+a).append(s(i)),S=n,e(".spinner-wrapper").addClass("_loaded"),E()}),t.attr("data-page",h+1)}function _(t){var a=[],i=3,o=0,l=0,r=0,s=t.length,n=Math.ceil(s/i);for(e("#page").attr("data-rown",n),l=0;i>l;l++){var c=0;for(r=0;n>r;r++){if(0===r)var c=l;else var c=c+i;s>o&&(a[o]=c),o++}}return a}function j(){e(".the-edit-issue").on("click",s),e(".the-edit-articles-load-more").on("click",I),e(".the-edit-load-more").on("click",n),e("body").on("click",".edit-article-teaser-link",P),e("body").on("click",".article-category-image",A),e(".the-edit-archive-load-more").on("click",I),e(".the-edit-article-text-load-more").on("click",h),e(".the-edit-article-text-load-less").on("click",p),e(".the-edit-article-nav.the-edit-article-previous").on("click",g),e(".the-edit-article-nav.the-edit-article-next").on("click",y),e(".button-gold.overlay-open.runway-gallery-open").on("click",u),e(".photo-gallery-nav-option.middle").on("click",k),e(".style-news-page.the-edit-article-page .video-parent").on("click",".play",w),e(".gucci-dim").on("click",function(e){e.preventDefault()}),e(".stories-related").on("click","[data-link]",function(){e(this).parents("article").find("[data-link-cta]")[0].click()}),e(".next-article").on("click",c),e(".photo-gallery-nav-option").on("click",".overlay-open",x),e(".social-overlay-close").on("click",D),e(window).on("hashchange",v),b(),a.change(E),e(".social-trigger").on("click",d),e(".banner").on("click",E)}function N(){var t=e(".the-edit-articles.open");t.length>0&&I(),e(".page-TheEditArchivePage").length&&E(),l.load(".fullscreen-overlay",{bodyClassOpen:"overlay-open",bodyClassClose:"overlay-closing",fadingTime:500,handlerImages:".js-overlay-trigger"})}var O=4,H=9,S="";return e.fn.reOrder=function(t){var a=e("#page").attr("data-rown");return this.each(function(){if(t){for(var i=0;i<t.length;i++)e(".page-TheEditArchivePage").length?t[i]=e('li[class="the-edit-article pos'+t[i]+'"]'):t[i]=e('.open li[class="the-edit-article pos'+t[i]+'"]');e(this).empty();for(var i=0;i<t.length;i++)i%a===0&&0!==i&&e(this).append('<li class="column-break"></li>'),e(this).append(t[i])}})},i.registerHelper("each_upto",function(t,a,i){var o,l;if(o=e(e(".page-TheEditArchivePage").length?".the-edit-archive-load-more":"#"+S+" .the-edit-articles-load-more"),!t||0===t.length)return i.inverse(this);var r=parseInt(o.attr("data-page")),s=H*r;l=e(".page-TheEditArchivePage").length?s:a+s;var n=[];(l>t.length||t.length<=H||0===t.length)&&o.addClass("hide");for(var c=0;l>c&&c<t.length;++c)n.push(i.fn(t[c]));return n.join("")}),{load:function(){function e(){}j(),v(),t.dispatchAndListen("theEdit",e)}}});