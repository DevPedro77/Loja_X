define("fullscreenslide",["jquery","imageLoader","video","savedItems","keysNavigationFocusable","pageDirection"],function(e,t,i,o,n,s){function a(t,i){var o=this;this.element=e(t),this.options=e.extend({},d,i||{}),this.mainContainer=this.element.find(".main-container"),this.closeHandler=this.element.find(".close"),this.navLastItem=this.element.find(".last-item"),this.navCurrentItem=this.element.find(".current-item"),this.closeHandler=this.element.find(".close"),this.leftArrow=this.element.find(".arrow-left"),this.rightArrow=this.element.find(".arrow-right"),this.navItems=this.element.find(".nav-items"),this.PRESSED_KEY,this.keyCodes={UP:38,DOWN:40,LEFT:37,RIGHT:39,ESC:27,ENTER:13},this.winWidth=e(window).width(),e(this.options.handlerImages).off("click.fss").on("click.fss",function(t){t.preventDefault(),t.stopPropagation();var i=e(this).data("href");if(i){var n=e(this).data("product-code");o.openOverlay(i,n)}e(this).addClass("opener")}),this.leftArrow.off("click.fss").on("click.fss",function(e){s.isRtl?o.moveRight():o.moveLeft()}),this.rightArrow.off("click.fss").on("click.fss",function(e){s.isRtl?o.moveLeft():o.moveRight()}),this.closeHandler.off("click.fss").on("click.fss",function(e){o.closeOverlay()}),e(document).off("keydown.fss").on("keydown.fss",function(e){o.SHOWN&&o.winWidth>=o.options.mobileResolutionThreshold&&o.onKeyEvent(e)}),e(window).off("resize.fss").on("resize.fss",function(){o.resized()}),e(window).off("mousewheel.fss DOMMouseScroll.fss").on("mousewheel.fss DOMMouseScroll.fss",function(e){o.SHOWN&&o.winWidth>=o.options.mobileResolutionThreshold&&o.onMouseWheel(e)}),this.resized(),e(document).ready(function(){var e=window.location.pathname+"/shop-all",t=window.location.hash;if(t){var i=t.replace("#sa","");o.openOverlay(e,i)}})}function r(e,t){return h||(h=new a(e,t))}var d={bodyClassOpen:"overlay-open",bodyClassClose:"overlay-closing",fadingTime:500,handlerImages:".js-overlay-trigger",mobileResolutionThreshold:1024,sliderContainer:".slides-container",mobileButtonsFilter:".content-button"},l=n.focusable;a.prototype.manipulateDescriptions=function(e){var t=this;if(t.winWidth>=t.options.mobileResolutionThreshold)t.mainContainer.append(e[0].descriptionTop.hide().addClass("fadeOut").detach()),t.mainContainer.append(e[0].descriptionBottom.hide().addClass("fadeOut").detach());else if(t.winWidth<t.options.mobileResolutionThreshold){var i=e.find(".slides-container .slide");i.eq(0).prepend(e[0].descriptionTop.show().removeClass("fadeOut").detach()),i.eq(1).append(e[0].descriptionBottom.show().removeClass("fadeOut").detach())}},a.prototype.resized=function(){var t=this;if(this.winWidth=e(window).width(),this.itemsContainer&&this.itemsContainer.length){this.winWidth<this.options.mobileResolutionThreshold&&this.itemsContainer.find(".product-description.bottom, .product-description.top").removeClass("fadeOut fadeIn"),this.items.each(function(i,o){var n=e(o);if(t.isMobiled&&t.winWidth>=t.options.mobileResolutionThreshold)t.mainContainer.append(n[0].descriptionTop),t.mainContainer.append(n[0].descriptionBottom);else if(!t.isMobiled&&t.winWidth<t.options.mobileResolutionThreshold){var s=n.find(".slides-container .slide");s.eq(0).prepend(n[0].descriptionTop),s.eq(1).append(n[0].descriptionBottom)}});var i=this.items.find(this.options.sliderContainer);i.off("click.fss_mv").on("click.fss_mv",".scroll-down",function(o){if(t.isMobiled){var n=e(o.target).parents(".slide").eq(0).height();n&&i.animate({scrollTop:n},{duration:500}),e(this).closest(".slide").find(".content-up").animate({opacity:0},{duration:800}),e(this).closest(".slides-container").find(".content-down").animate({opacity:1},{duration:800})}else t.moveDown();o.stopPropagation(),o.preventDefault()})}this.isMobiled=this.winWidth<=this.options.mobileResolutionThreshold},a.prototype.moveLeft=function(){this.itemsContainer&&this.itemsContainer.length&&(this.itemsContainer.slick("slickPrev"),this.itemShown.find(this.options.sliderContainer).find("video.bg-video").each(function(){this.pause()}))},a.prototype.moveRight=function(){this.itemsContainer&&this.itemsContainer.length&&(this.itemsContainer.slick("slickNext"),this.itemShown.find(this.options.sliderContainer).find("video.bg-video").each(function(){this.pause()}))},a.prototype.moveDown=function(){var e=this.itemShown.find(this.options.sliderContainer).find(".slide"),t=e.length;if(!(1>=t)){this.itemShown.find(this.options.sliderContainer).addClass("slide-is-down");var i=this.itemShown[0].descriptionTop,o=this.itemShown[0].descriptionBottom;i.removeClass("fadeIn").addClass("fadeOut"),o.removeClass("fadeIn").addClass("fadeOut"),this.moveUpDownTimeout&&clearTimeout(this.moveUpDownTimeout),this.moveUpDownTimeout=setTimeout(function(){o.show().removeClass("fadeOut").addClass("fadeIn")},500),this.itemShown.find(this.options.sliderContainer).find("video.bg-video").each(function(){this.play()})}},a.prototype.moveUp=function(){this.itemShown.find(this.options.sliderContainer).removeClass("slide-is-down");var e=this.itemShown[0].descriptionTop,t=this.itemShown[0].descriptionBottom;t.removeClass("fadeIn").addClass("fadeOut"),e.removeClass("fadeIn").addClass("fadeOut"),this.moveUpDownTimeout&&clearTimeout(this.moveUpDownTimeout),this.moveUpDownTimeout=setTimeout(function(){e.removeClass("fadeOut").addClass("fadeIn")},500),this.itemShown.find(this.options.sliderContainer).find("video.bg-video").each(function(){this.pause()})},a.prototype.updateCounterNav=function(e){10>e?this.navCurrentItem.text("0"+e):this.navCurrentItem.text(e)},a.prototype.resetContentStyle=function(){var e=this.itemShown[0].descriptionBottom;this.winWidth>this.options.mobileResolutionThreshold&&e.removeClass("fadeIn").addClass("fadeOut")},a.prototype.openOverlay=function(n,s){var a=this;return a.SHOWN?void(console&&console.warn&&console.warn("Overlay already opened")):(a.SHOWN=!0,a.mainContainer.empty(),a.navItems.hide(),e("body").addClass(a.options.bodyClassOpen),a.element.addClass("loading"),void e.ajax({type:"get",url:n,success:function(n){if(a.SHOWN){var r=e(n);a.mainContainer.append(r);try{a.init(s),o.fillSavedItems(),t.loadImage(a.mainContainer),i.loadVideoInContext(a.mainContainer)}catch(d){console&&console.error&&console.error("Error: error init overlay",d),a.closeOverlay()}finally{a.element.removeClass("loading"),e(document).trigger("overlay.open")}e(a.element).find(l).first().focus()}},error:function(e){console&&console.warn&&console.warn("Warning: response with errors",e.responseText),a.element.removeClass("loading"),a.closeOverlay()}}))},a.prototype.closeOverlay=function(){e("body").addClass(this.options.bodyClassClose);var t=this.options.bodyClassOpen+" "+this.options.bodyClassClose;setTimeout(function(){e("body").removeClass(t)},this.options.fadingTime),this.currentItem=1,this.SHOWN=!1,this.destroy(),e(this.options.handlerImages).filter(".opener").focus()},a.prototype.init=function(t){var i=this;this.itemsContainer=this.element.find(".items-container"),this.items=this.itemsContainer.find(".item"),this.itemsContainer.find(".save-text").off("click.fss").on("click.fss",function(t){t.preventDefault(),t.stopPropagation(),e(this).parent(".save").trigger("click")});var o=this.items.length;10>o?this.navLastItem.text("0"+o):this.navLastItem.text(o),this.navItems.toggle(o>1),this.items.each(function(t,o){var n=e(o),s=n.find(".product-description.top"),a=n.find(".product-description.bottom");n[0].descriptionTop=s,n[0].descriptionBottom=a,i.manipulateDescriptions(n)});var n=function(e){i.itemShown=i.itemsContainer.find(".item.slick-active[data-product-code="+e+"]"),i.winWidth>=i.options.mobileResolutionThreshold?i.itemShown.find(".slides-container.slide-is-down").length||void 0==i.itemShown[0]||i.itemShown[0].descriptionTop.show().removeClass("fadeOut").addClass("fadeIn"):(i.mainContainer.find(" > "+i.options.mobileButtonsFilter).remove(),i.mainContainer.append(i.itemShown.find(i.options.mobileButtonsFilter).clone(!0,!0)))},s=function(t){var i=e(".hid-your-selections-wrapper"),o=i.data("currency"),n=t.price;n=n.replace(",",".");var s={item_list_name:"ShoppableStory",item_id:t.code,item_name:t.name,item_brand:"unknown",currency:o,index:t.index,item_category:t.categorypath,item_variant:"",price:n,quantity:"1"};return s},a=function(e){if(overlayProducts){var t=overlayProducts[e],i=t.price;i=i.replace(",","."),dataLayer.push({event:"productImpression",ecommerce:{impressions:[{category:t.categorypath,id:t.code,list:"ShoppableStory",name:t.name,position:t.index,price:i,variant:""}]}});try{window.analyticsSdk.tracking.sendEvent({name:"view_item_list",event:{event:"view_item_list",country:window.location.pathname.split("/")[1],language:window.location.pathname.split("/")[2],item_list_id:window.location.pathname,item_list_name:"ShoppableStory",items:[s(t)]}})}catch(o){console.error("Problem with Analystics SDK: unable to track view_item_list")}}},r=function(e){window.location.hash="sa"+e},d=this.itemsContainer.find("[data-product-code='"+t+"']").index();this.itemsContainer.slick({initialSlide:d,infinite:!0,speed:800,cssEase:"ease",slidesToShow:1,swipe:!1,touchMove:!1,rtl:"rtl"===e("html").attr("dir").toLowerCase(),accessibility:!1,arrows:!1,responsive:[{breakpoint:1024,settings:{swipe:!0}}]}).on("setPosition",function(t,i){var o=e(i.$slides[i.currentSlide]).data("product-code");n(o)}).on("beforeChange",function(e,t,o,n){i.itemShown&&i.winWidth>=i.options.mobileResolutionThreshold&&(i.itemShown[0].descriptionTop.removeClass("fadeIn").addClass("fadeOut").hide(),i.itemShown[0].descriptionBottom.removeClass("fadeIn").addClass("fadeOut").hide(),setTimeout(function(){i.SHOWN&&i.items&&i.items.length>0&&i.items.eq(n)[0].descriptionTop.show().removeClass("fadeOut").addClass("fadeIn")},500)),i.updateCounterNav(n+1)}).on("afterChange",function(t,o,n){i.itemShown&&i.itemShown.data("slickIndex")!=n&&(i.itemsContainer.find(i.options.sliderContainer+".slide-is-down").removeClass("slide-is-down"),i.winWidth<i.options.mobileResolutionThreshold&&i.itemShown.find(i.options.sliderContainer).scrollTop(0),i.resetContentStyle(),e(this).find(".content-up").stop(!0,!1).animate({opacity:1},{duration:800}),i.itemShown.find(".content-down").stop(!0,!1).animate({opacity:1},{duration:800}));var s=e(o.$slides[n]).data("product-code");a(s),r(s)}),this.resized(),n(t),a(t),r(t),i.updateCounterNav(d+1)},a.prototype.destroy=function(){try{this.itemsContainer&&this.itemsContainer.slick("unslick")}catch(e){console&&console.error&&console.error(e)}this.mainContainer.empty(),window.location.hash="",this.itemsContainer&&delete this.itemsContainer,delete this.itemShown,delete this.items,delete this.currentItem},a.prototype.onKeyEvent=function(e){var t=e.keyCode;t==this.keyCodes.UP&&this.itemShown.find(this.options.sliderContainer).hasClass("slide-is-down")?(this.moveUp(),e.preventDefault()):t!=this.keyCodes.DOWN||this.itemShown.find(this.options.sliderContainer).hasClass("slide-is-down")?t==this.keyCodes.LEFT?(this.moveLeft(),e.preventDefault()):t==this.keyCodes.RIGHT?(this.moveRight(),e.preventDefault()):t==this.keyCodes.ESC&&(this.closeOverlay(),e.preventDefault()):(this.moveDown(),e.preventDefault())},a.prototype.onMouseWheel=function(e){var t=e.originalEvent.wheelDelta/30||-e.originalEvent.detail;-1>t&&!this.itemShown.find(this.options.sliderContainer).hasClass("slide-is-down")?this.moveDown():t>1&&this.itemShown.find(this.options.sliderContainer).hasClass("slide-is-down")&&this.moveUp(),e.preventDefault()},e.fn.moveVertically=function(t){return this.each(function(){var t=e(this),i=t.find(".slide:first"),o=t.find(".slide:last"),n=!1,s=!1,a=i.height(),r=a/5,d=0,l=!1;i.off("touchstart.fss_mv").on("touchstart.fss_mv",function(e){var i=e.originalEvent.touches[0];d=i.pageY,t.stop(!0,!1),t.find(".content-down").css("opacity",0)}).off("touchmove.fss_mv").on("touchmove.fss_mv",function(e){var i=e.originalEvent.touches[0],o=i.pageY,n=Math.max(d-o,0);s=n>r;var a=n/r,h=1-a;t.find(".content-up").css("opacity",h),n&&(l||(l=!0,requestAnimationFrame(function(){t.scrollTop(n),l=!1}))),e.preventDefault()}).off("touchend.fss_mv").on("touchend.fss_mv",function(e){t.stop(!0,!1).animate({scrollTop:s?a:0}),t.find(".content-up").stop(!0,!1).animate({opacity:s?0:1},{duration:800}),t.find(".content-down").stop(!0,!1).animate({opacity:s?1:0},{duration:800})});var h=0,c=a,m=!1;o.off("touchstart.fss_mv").on("touchstart.fss_mv",function(e){var i=e.originalEvent.touches[0];h=i.pageY,c=t.scrollTop(),t.stop(!0,!1)}).off("touchmove.fss_mv").on("touchmove.fss_mv",function(e){var i=e.originalEvent.touches[0],a=i.pageY,d=a-h;if(s=d>r,c-d<=o.height()&&!n&&!m){m=!0;var l=d/r,p=l/2,f=1-l;t.find(".content-up").css("opacity",p),t.find(".content-down").css("opacity",f),requestAnimationFrame(function(){t.scrollTop(c-d),m=!1})}e.preventDefault()}).off("touchend.fss_mv").on("touchend.fss_mv",function(e){t.scrollTop()<a&&(t.stop(!0,!1).animate({scrollTop:s?0:a}),t.find(".content-up").stop(!0,!1).animate({opacity:s?1:0},{duration:800}),t.find(".content-down").stop(!0,!1).animate({opacity:s?0:1},{duration:800}))})}),this};var h;return{load:function(e,t){return r(e,t)}}});